@page "/players"
@using MagicMatchTracker.Features.Players.Services
@using MagicMatchTracker.Features.Players.Components
@attribute [StreamRendering]
@inherits StatefulComponentBase<PlayerListingState>
@rendermode InteractiveServer

<PageTitle>Players - Match Tracker</PageTitle>

<h1>Players</h1>

<button class="btn btn-primary btn-fab"
        disabled="@(State.Players is null)"
        @onclick="() => State.ShowNewPlayerDialogAsync()">
	<span class="icon filled" aria-hidden="true">person_add</span>
	<span>New player</span>
</button>

@if (State.Players is null)
{
	<ul class="list-group list-group-flush">
		@for (int i = 0; i < 8; i++)
		{
			var width = Random.Shared.Next(70, 170);
			<li class="list-group-item d-flex justify-content-between align-items-stretch placeholder-glow">
				<span class="d-flex align-items-center gap-2">
					<span class="placeholder placeholder-avatar"></span>
					<span class="placeholder" style="width: @(width)px;"></span>
				</span>
				<a class="btn btn-ghost-secondary btn-square disabled placeholder"></a>
			</li>
		}
	</ul>
	return;
}

<PlayerEditDialog/>

@if (State.Players.Count == 0)
{
	<p>No players available.</p>
	return;
}

<ul class="list-group list-group-flush player-list">
	@foreach (var player in State.Players)
	{
		<li class="player-entry list-group-item d-flex align-items-stretch gap-2 px-4">
			<a href="/players/@player.Id" class="player-link text-body text-decoration-none flex-fill d-flex align-items-center gap-2">
				<Avatar Player="player" Size="28"/>
				<span>@player.Name</span>
			</a>
			<button class="btn btn-ghost-secondary btn-square hover-icon-filled"
			        title="Edit player"
			        @onclick="() => State.ShowEditPlayerDialogAsync(player)">
				<span class="icon" aria-hidden="true">edit</span>
			</button>
		</li>
	}
</ul>

@code {

	/// <inheritdoc />
	protected override async Task OnAfterRenderAsync(bool firstRender)
	{
		if (!firstRender)
			return;

		await State.LoadPlayersAsync();
		StateHasChanged();
	}

}