@page "/"
@using MagicMatchTracker.Features.Shared.Options
@using MagicMatchTracker.Infrastructure.Authentication.Discord
@using MagicMatchTracker.Infrastructure.Services
@using Microsoft.AspNetCore.Components.Authorization
@using Microsoft.Extensions.Options
@attribute [Authorize]
@inject ApplicationVersionProvider VersionProvider
@inject IOptions<ChangelogOptions> ChangelogOptions

<PageTitle>Match Tracker</PageTitle>

<h1>Match Tracker - Commander</h1>

<AuthorizeView>
	<Authorized>
		<div class="d-flex align-items-center gap-2">
			<span class="text-muted">Signed in as @(context.User.Identity?.DisplayName)</span>
			<form action="/account/signout" method="post">
				<AntiforgeryToken/>
				<input type="hidden" name="ReturnUrl" value=""/>
				<button type="submit" class="btn btn-link p-0 d-flex">
					<span>Sign out</span>
				</button>
			</form>
		</div>

		@if (!context.User.IsInRole(Roles.Owner))
		{
			<div class="alert alert-warning text-content d-inline-flex align-items-start gap-2 mt-3" role="alert">
				<span class="icon filled">warning</span>
				<span>You don't have permission to access the rest of the website.</span>
			</div>
		}
	</Authorized>
</AuthorizeView>

<div class="position-fixed bottom-0 py-3">
	<div class="d-flex align-items-center justify-content-between gap-2 small">
		<div class="text-muted">Version @(VersionProvider.Version)</div>
		<span class="text-muted small">&bull;</span>
		<a href="@ChangelogOptions.Value.UrlFormat.Format(VersionProvider.VersionPrefix)" target="_blank">
			Changelog
		</a>
	</div>
</div>